# midiprepare
This tool allows you to prepare SMF MIDI files for our build.

## Usage
`midiprepare` prepares the SMFs generated by LilyPond for our build pipeline. This is needed for multiple reasons:

- `fluidsynth` cuts off the audio as soon as the last note is released, which cuts off the release curve of the last samples. Because of this, `midiprepare` adds a silent note event a few seconds after the last note event in the input file.
- The fairground organ pieces need to be rendered separately with two different SoundFonts - one for the organ part and one for the accompaniment (glockenspiel and percussion). `midiprepare` separates these two parts so they can be rendered independently from each other and mixed again afterwards. It would be possible to load multiple SoundFonts into FluidSynth, but that would be much more complicated.
- The organ part of the fairground organ pieces needs to be mapped from MIDI instruments to predefined organ registrations. `midiprepare` can remap the patches in the SMF.

### Parameter description
- `-s` *split mode* - turns on the split mode, which allows you to specify which patches should be kept in the output file and what patches should be mapped to them.
- `-f patch` *from* - 'from' maps *from* a patch and specifies which patches to keep. Always in combination with `-t`.
- `-t patch` *to* - 'to' maps *to* a patch. Always in combination with `-f`.
- `-p` *percussion* - maps the percussion (track 10).
- `-m patch` *map percussion* - maps the percussion to a different patch (like 48 for orchestral percussion).
- `-a seconds` *append* - Adds a note event after the last note in the input. Defaults to 5.0 seconds.
- `-o file` *output* - Specifies the output file.
- `-v` *verbose* - Enables status output.

## Build
`midiprepare` depends on [libsmf](https://sourceforge.net/projects/libsmf/).

    mkdir build && cd build
    cmake ..
    make
